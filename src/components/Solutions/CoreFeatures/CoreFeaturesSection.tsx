"use client";

import React, { useEffect, useRef } from "react";
import svgPaths from "../../../imports/svg-plhzsxyavn";
import { Swiper, SwiperSlide } from "swiper/react";
import { Navigation } from "swiper/modules";
import type { Swiper as SwiperClass } from "swiper";
import type { SwiperOptions } from "swiper/types";
import "swiper/css";
import "swiper/css/navigation";

/* ---------------------------
   Icon Components (unchanged visuals)
   --------------------------- */

function ChartRelationship() {
  return (
    <div
      className="overflow-clip relative shrink-0 size-[36px]"
      data-name="chart-relationship"
    >
      <div className="absolute inset-[8.33%]" data-name="elements">
        <div className="absolute inset-[-3.33%]">
          <svg
            className="block size-full"
            fill="none"
            preserveAspectRatio="none"
            viewBox="0 0 32 32"
          >
            <g>
              <path
                d="M14.5 5.5L25 5.5"
                id="Vector"
                stroke="var(--stroke-0, white)"
                strokeLinecap="round"
                strokeLinejoin="round"
                strokeWidth="2"
              />
              <path
                d="M13 13L19.75 19.75"
                id="Vector_2"
                stroke="var(--stroke-0, white)"
                strokeLinecap="round"
                strokeLinejoin="round"
                strokeWidth="2"
              />
              <path
                d="M5.5 14.5L5.5 25"
                id="Vector_3"
                stroke="var(--stroke-0, white)"
                strokeLinecap="round"
                strokeLinejoin="round"
                strokeWidth="2"
              />
              <circle
                cx="7.66667"
                cy="7.66667"
                id="Ellipse 1557"
                r="6.66667"
                stroke="var(--stroke-0, white)"
                strokeWidth="2"
              />
              <circle
                cx="5.5"
                cy="28"
                id="Ellipse 1558"
                r="3"
                stroke="var(--stroke-0, white)"
                strokeWidth="2"
              />
              <circle
                cx="22"
                cy="22"
                id="Ellipse 1559"
                r="3"
                stroke="var(--stroke-0, white)"
                strokeWidth="2"
              />
              <circle
                cx="28"
                cy="5.5"
                id="Ellipse 1560"
                r="3"
                stroke="var(--stroke-0, white)"
                strokeWidth="2"
              />
            </g>
          </svg>
        </div>
      </div>
    </div>
  );
}

function ArtificialIntelligence() {
  return (
    <div
      className="overflow-clip relative shrink-0 size-[36px]"
      data-name="artificial-intelligence-04"
    >
      <div className="absolute inset-[8.33%]" data-name="elements">
        <div className="absolute inset-[-3.33%]">
          <svg
            className="block size-full"
            fill="none"
            preserveAspectRatio="none"
            viewBox="0 0 32 32"
          >
            <g>
              <path
                d={svgPaths.p272cd480}
                id="Vector"
                stroke="var(--stroke-0, white)"
                strokeLinejoin="round"
                strokeWidth="2"
              />
              <path
                d={svgPaths.p69ef200}
                id="Vector_2"
                stroke="var(--stroke-0, white)"
                strokeLinecap="round"
                strokeLinejoin="round"
                strokeWidth="2"
              />
              <path
                d="M21.25 11.5V20.5"
                id="Vector_3"
                stroke="var(--stroke-0, white)"
                strokeLinecap="round"
                strokeLinejoin="round"
                strokeWidth="2"
              />
              <path
                d={svgPaths.p2cf251a0}
                id="Vector_4"
                stroke="var(--stroke-0, white)"
                strokeLinecap="round"
                strokeLinejoin="round"
                strokeWidth="2"
              />
            </g>
          </svg>
        </div>
      </div>
    </div>
  );
}

function DatabaseExport() {
  return (
    <div
      className="overflow-clip relative size-[36px]"
      data-name="database-export"
    >
      <div className="absolute flex inset-[8.33%_20.83%_8.33%_12.5%] items-center justify-center">
        <div className="flex-none h-[30px] scale-y-[-100%] w-[24px]">
          <div className="relative size-full" data-name="elements">
            <div className="absolute inset-[-3.33%_-4.17%]">
              <svg
                className="block size-full"
                fill="none"
                preserveAspectRatio="none"
                viewBox="0 0 26 32"
              >
                <g>
                  <ellipse
                    cx="13"
                    cy="5.5"
                    id="Ellipse 1578"
                    rx="12"
                    ry="4.5"
                    stroke="var(--stroke-0, white)"
                    strokeWidth="2"
                  />
                  <path
                    d={svgPaths.pc4a3780}
                    id="Vector"
                    stroke="var(--stroke-0, white)"
                    strokeLinecap="round"
                    strokeWidth="2"
                  />
                  <path
                    d={svgPaths.p1c16d300}
                    id="Vector_2"
                    stroke="var(--stroke-0, white)"
                    strokeLinecap="round"
                    strokeWidth="2"
                  />
                  <path
                    d={svgPaths.p10604900}
                    id="Vector_3"
                    stroke="var(--stroke-0, white)"
                    strokeLinecap="round"
                    strokeWidth="2"
                  />
                  <path
                    d={svgPaths.p38e2870}
                    id="Vector_4"
                    stroke="var(--stroke-0, white)"
                    strokeLinecap="round"
                    strokeLinejoin="round"
                    strokeWidth="2"
                  />
                  <path
                    d={svgPaths.p2f4f6100}
                    id="Vector_5"
                    stroke="var(--stroke-0, white)"
                    strokeLinecap="round"
                    strokeLinejoin="round"
                    strokeWidth="2"
                  />
                </g>
              </svg>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
}

function VuesaxLinearDanger() {
  return (
    <div
      className="relative shrink-0 size-[36px]"
      data-name="vuesax/linear/danger"
    >
      <div
        className="absolute contents inset-0"
        data-name="vuesax/linear/danger"
      >
        <svg
          className="block size-full"
          fill="none"
          preserveAspectRatio="none"
          viewBox="0 0 36 36"
        >
          <g id="danger">
            <path
              d="M18 13.5V21"
              id="Vector"
              stroke="var(--stroke-0, white)"
              strokeLinecap="round"
              strokeLinejoin="round"
              strokeWidth="2"
            />
            <path
              d={svgPaths.pf025680}
              id="Vector_2"
              stroke="var(--stroke-0, white)"
              strokeLinecap="round"
              strokeLinejoin="round"
              strokeWidth="2"
            />
            <path
              d="M17.9918 25.5H18.0052"
              id="Vector_3"
              stroke="var(--stroke-0, white)"
              strokeLinecap="round"
              strokeLinejoin="round"
              strokeWidth="2"
            />
            <g id="Vector_4" opacity="0"></g>
          </g>
        </svg>
      </div>
    </div>
  );
}

function Energy() {
  return (
    <div
      className="overflow-clip relative shrink-0 size-[36px]"
      data-name="chart-relationship"
    >
      <div className="absolute inset-[8.33%]" data-name="elements">
        <div className="absolute inset-[-3.33%]">
          <svg
            width="36"
            height="36"
            viewBox="0 0 36 36"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M30 21.7479C30 27.9623 24.6274 33 18 33C11.3726 33 6 27.9623 6 21.7479L6 21.4191C6 20.3177 6 19.767 6.38047 19.565C7.20509 19.1272 9 21 9 21"
              stroke="white"
              strokeWidth={2}
              strokeLinecap="round"
              strokeLinejoin="round"
            />
            <path
              d="M6 14.2521C6 8.03773 11.3726 3 18 3C24.6274 3 30 8.03773 30 14.2521V14.5809C30 15.6823 30 16.233 29.6195 16.435C28.7949 16.8728 27 15 27 15"
              stroke="white"
              strokeWidth={2}
              strokeLinecap="round"
              strokeLinejoin="round"
            />
            <path
              d="M17.9694 16.7407C16.8901 18.8761 16.1019 22.3392 17.3433 26.25M16.7146 22.5425C10.3459 18.0118 14.721 12.8006 18.8399 10.1703C19.337 9.85283 19.5855 9.69411 19.8748 9.76785C20.1642 9.84159 20.3032 10.1011 20.5813 10.6201C22.8935 14.9355 24.5501 21.7339 16.7146 22.5425Z"
              stroke="white"
              strokeWidth={2}
              strokeLinecap="round"
              strokeLinejoin="round"
            />
          </svg>
        </div>
      </div>
    </div>
  );
}

function Prediction() {
  return (
    <div
      className="overflow-clip relative shrink-0 size-[36px]"
      data-name="chart-relationship"
    >
      <div className="absolute inset-[8.33%]" data-name="elements">
        <div className="absolute inset-[-3.33%]">
          <svg
            width="36"
            height="36"
            viewBox="0 0 36 36"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <circle cx="18" cy="27" r="4.5" stroke="white" strokeWidth={2} />
            <path
              d="M18 22.5V15"
              stroke="white"
              strokeWidth={2}
              strokeLinecap="round"
            />
            <path
              d="M33 19.5C33 11.2157 26.2843 4.5 18 4.5C9.71573 4.5 3 11.2157 3 19.5"
              stroke="white"
              strokeWidth={2}
              strokeLinecap="round"
            />
          </svg>
        </div>
      </div>
    </div>
  );
}

function Sun() {
  return (
    <div
      className="overflow-clip relative shrink-0 size-[36px]"
      data-name="chart-relationship"
    >
      <div className="absolute inset-[8.33%]" data-name="elements">
        <div className="absolute inset-[-3.33%]">
          <svg
            width="36"
            height="36"
            viewBox="0 0 36 36"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M25.5 18C25.5 22.1421 22.1421 25.5 18 25.5C13.8579 25.5 10.5 22.1421 10.5 18C10.5 13.8579 13.8579 10.5 18 10.5C22.1421 10.5 25.5 13.8579 25.5 18Z"
              stroke="white"
              strokeWidth={2}
            />
            <path
              d="M18 3V5.25M18 30.75V33M28.6062 28.6069L27.0152 27.0159M8.98389 8.98389L7.3929 7.3929M33 18H30.75M5.25 18H3M28.6069 7.39307L27.0159 8.98406M8.98462 27.0161L7.39363 28.6071"
              stroke="white"
              strokeWidth={2}
              strokeLinecap="round"
            />
          </svg>
        </div>
      </div>
    </div>
  );
}

function Data() {
  return (
    <div
      className="overflow-clip relative shrink-0 size-[36px]"
      data-name="chart-relationship"
    >
      <div className="absolute inset-[8.33%]" data-name="elements">
        <div className="absolute inset-[-3.33%]">
          <svg
            width="36"
            height="36"
            viewBox="0 0 36 36"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M30 21C31.6569 21 33 19.6569 33 18C33 16.3431 31.6569 15 30 15C28.3431 15 27 16.3431 27 18C27 19.6569 28.3431 21 30 21Z"
              stroke="white"
              strokeWidth={2}
              strokeLinecap="round"
              strokeLinejoin="round"
            />
            <path
              d="M30 9C31.6569 9 33 7.65685 33 6C33 4.34315 31.6569 3 30 3C28.3431 3 27 4.34315 27 6C27 7.65685 28.3431 9 30 9Z"
              stroke="white"
              strokeWidth={2}
              strokeLinecap="round"
              strokeLinejoin="round"
            />
            <path
              d="M30 33C31.6569 33 33 31.6569 33 30C33 28.3431 31.6569 27 30 27C28.3431 27 27 28.3431 27 30C27 31.6569 28.3431 33 30 33Z"
              stroke="white"
              strokeWidth={2}
              strokeLinecap="round"
              strokeLinejoin="round"
            />
            <path
              d="M6 21C7.65685 21 9 19.6569 9 18C9 16.3431 7.65685 15 6 15C4.34315 15 3 16.3431 3 18C3 19.6569 4.34315 21 6 21Z"
              stroke="white"
              strokeWidth={2}
              strokeLinecap="round"
              strokeLinejoin="round"
            />
            <path
              d="M9 18H27"
              stroke="white"
              strokeWidth={2}
              strokeLinecap="round"
              strokeLinejoin="round"
            />
            <path
              d="M27 6H21C18 6 16.5 7.5 16.5 10.5V25.5C16.5 28.5 18 30 21 30H27"
              stroke="white"
              strokeWidth={2}
              strokeLinecap="round"
              strokeLinejoin="round"
            />
          </svg>
        </div>
      </div>
    </div>
  );
}

/* ---------------------------
   Core Feature Card
   --------------------------- */
function CoreFeatureCard({
  icon,
  title,
  description,
}: {
  icon: string;
  title: string;
  description: string;
}) {
  const IconComponent =
    icon === "chart-relationship"
      ? ChartRelationship
      : icon === "artificial-intelligence"
      ? ArtificialIntelligence
      : icon === "database-export"
      ? DatabaseExport
      : icon === "energy"
      ? Energy
      : icon === "prediction"
      ? Prediction
      : icon === "sun"
      ? Sun
      : icon === "data"
      ? Data
      : VuesaxLinearDanger;

  return (
    <div className="bg-[rgba(255,255,255,0.16)] backdrop-blur-md box-border flex flex-col gap-[20px] items-start p-[24px] rounded-[16px] h-full min-h-[280px] transition-all duration-300 hover:bg-[rgba(255,255,255,0.22)]">
      <div className="shrink-0">
        {icon === "database-export" ? (
          <div className="flex items-center justify-center">
            <div className="flex-none scale-y-[-100%]">
              <IconComponent />
            </div>
          </div>
        ) : (
          <IconComponent />
        )}
      </div>
      <div className="flex flex-col gap-[16px] flex-1">
        <h3 className="font-semibold leading-[28px] text-[#00ff84] text-[20px] m-0">
          {title}
        </h3>
        <p className="font-normal leading-[22px] text-[14px] text-white text-opacity-90 m-0">
          {description}
        </p>
      </div>
    </div>
  );
}

/* ---------------------------
   Frame35 (title + description)
   --------------------------- */

function Frame35({ content }: any) {
  return (
    <div className="flex flex-col md:flex-row items-start md:justify-between gap-6 md:gap-8 text-white w-full">
      <h2 className="font-semibold text-[36px] md:text-[42px] leading-[42px] md:leading-[50px] text-white m-0 whitespace-nowrap">
        {content.title}
      </h2>
      <p className="font-normal text-[14px] md:text-[16px] leading-[22px] md:leading-[24px] text-white text-opacity-90 max-w-[645px] m-0">
        {content.description}
      </p>
    </div>
  );
}

/* ---------------------------
   Frame40 (Swiper v12)
   --------------------------- */

function Frame40({ content }: any) {
  const prevRef = useRef<HTMLButtonElement | null>(null);
  const nextRef = useRef<HTMLButtonElement | null>(null);
  const swiperRef = useRef<SwiperClass | null>(null);

  // central place for breakpoints â€” ensure slidesPerGroup <= slidesPerView
  const breakpoints: SwiperOptions["breakpoints"] = {
    1400: { slidesPerView: 4, slidesPerGroup: 3 },
    1280: { slidesPerView: 3, slidesPerGroup: 3 },
    1024: { slidesPerView: 2, slidesPerGroup: 2 },
    850: { slidesPerView: 2, slidesPerGroup: 2 },
    750: { slidesPerView: 1, slidesPerGroup: 1 },
    640: { slidesPerView: 1, slidesPerGroup: 1 },
    0: { slidesPerView: 1, slidesPerGroup: 1 },
  };

  const swiperOptions: SwiperOptions = {
    modules: [Navigation],
    slidesPerView: 4.25,
    slidesPerGroup: 5,
    spaceBetween: 15,
    // allowSlideNext: false,
    // allowSlidePrev: false,
    navigation: {
      prevEl: '.core-features-prev',
      nextEl: '.core-features-next',
    },
    autoHeight: true,
    breakpoints,
    observer: true,
    observeParents: true,
  };

  // store swiper instance when it's created
  const handleSwiper = (swiper: SwiperClass) => {
    swiperRef.current = swiper;
    // debug
    // eslint-disable-next-line no-console
    console.debug("Swiper instance set", swiper);
  };

  // Handle resize to update swiper
  useEffect(() => {
    const onResize = () => {
      if (swiperRef.current) {
        swiperRef.current.update();
      }
    };
    window.addEventListener("resize", onResize);

    return () => {
      window.removeEventListener("resize", onResize);
    };
  }, []);

  return (
    <div className="core-features-slider w-full max-w-full relative">
      {/* Prev */}
      <button
        type="button"
        ref={prevRef}
        aria-label="Previous slide"
        className="core-features-prev slick-arrow slick-prev absolute top-1/2 -translate-y-1/2 left-0 z-50"
        onClick={() => {
          // fallback ensures button always does something
          if (swiperRef.current) {
            swiperRef.current.slidePrev();
          } else {
            // eslint-disable-next-line no-console
            console.warn("swiperRef not ready for slidePrev()");
          }
        }}
        style={{
          pointerEvents: "auto", // ensure clickable
        }}
      >
        <svg
          width="22"
          height="22"
          viewBox="0 0 22 22"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            d="M18.6992 11H3.29922M3.29922 11L10.5714 3.29995M3.29922 11L10.5714 18.7"
            stroke="white"
            strokeWidth="1.5"
            strokeLinecap="round"
            strokeLinejoin="round"
          />
        </svg>
      </button>

      {/* Next */}
      <button
        type="button"
        ref={nextRef}
        aria-label="Next slide"
        className="core-features-next slick-arrow slick-next absolute top-1/2 -translate-y-1/2 right-0 z-50"
        onClick={() => {
          if (swiperRef.current) {
            swiperRef.current.slideNext();
          } else {
            // eslint-disable-next-line no-console
            console.warn("swiperRef not ready for slideNext()");
          }
        }}
        style={{
          pointerEvents: "auto",
        }}
      >
        <svg
          width="22"
          height="22"
          viewBox="0 0 22 22"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            d="M3.30078 11H18.7008M18.7008 11L11.4286 3.29995M18.7008 11L11.4286 18.7"
            stroke="white"
            strokeWidth="1.5"
            strokeLinecap="round"
            strokeLinejoin="round"
          />
        </svg>
      </button>

      <Swiper
        {...swiperOptions}
        onSwiper={handleSwiper}
        className="!overflow-visible"
      >
        {content?.features?.map((feature: any, index: number) => (
          <SwiperSlide key={index} className="h-full">
            <CoreFeatureCard
              icon={feature.icon}
              title={feature.title}
              description={feature.description}
            />
          </SwiperSlide>
        ))}
      </Swiper>
    </div>
  );
}

/* ---------------------------
   Export default component
   --------------------------- */

export default function CoreFeatures({ content }: any) {
  return (
    <div
      className="box-border flex flex-col gap-[50px] md:gap-[60px] items-start px-6 md:px-16 lg:px-[100px] pt-[50px] md:pt-[60px] pb-[130px] md:pb-[150px] w-full overflow-hidden"
      data-name="Core features"
      style={{
        background: "linear-gradient(242.47deg, #00BCEF 6.45%, #002363 95.13%)",
      }}
    >
      <Frame35 content={content} />
      <Frame40 content={content} />
    </div>
  );
}
